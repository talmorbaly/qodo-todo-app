<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React To-Do (Tailwind)</title>

    <!-- Tailwind CSS (Play CDN for zero build setup) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                200: '#bae6fd',
                300: '#7dd3fc',
                400: '#38bdf8',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
                800: '#075985',
                900: '#0c4a6e',
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen bg-slate-100 selection:bg-brand-200 selection:text-brand-900">
    <div class="container mx-auto max-w-xl p-6">
      <h1 class="text-3xl font-bold text-brand-700 mb-6">To-Do List</h1>
      <div id="app" class="bg-white shadow rounded-lg p-4"></div>
      <footer class="text-xs text-slate-500 mt-6">Tasks are saved locally in your browser.</footer>
    </div>

    <!-- React and ReactDOM (UMD for browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX transformation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Application Code -->
    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      const STORAGE_KEY = 'qodo_todo_tasks_v1';

      function useLocalStorageState(key, initialValue) {
        const [state, setState] = useState(() => {
          try {
            const raw = localStorage.getItem(key);
            return raw
              ? JSON.parse(raw)
              : typeof initialValue === 'function'
              ? initialValue()
              : initialValue;
          } catch (e) {
            console.warn('Failed to parse localStorage, using initial value.', e);
            return typeof initialValue === 'function' ? initialValue() : initialValue;
          }
        });

        useEffect(() => {
          try {
            localStorage.setItem(key, JSON.stringify(state));
          } catch (e) {
            console.warn('Failed to save to localStorage.', e);
          }
        }, [key, state]);

        return [state, setState];
      }

      function App() {
        const [tasks, setTasks] = useLocalStorageState(STORAGE_KEY, []);
        const [text, setText] = useState('');
        const remaining = useMemo(() => tasks.filter((t) => !t.completed).length, [tasks]);

        function addTask(e) {
          e.preventDefault();
          const value = text.trim();
          if (!value) return;
          const newTask = { id: cryptoRandomId(), text: value, completed: false };
          setTasks((prev) => [newTask, ...prev]);
          setText('');
        }

        function toggleTask(id) {
          setTasks((prev) => prev.map((t) => (t.id === id ? { ...t, completed: !t.completed } : t)));
        }

        function deleteTask(id) {
          setTasks((prev) => prev.filter((t) => t.id !== id));
        }

        function clearCompleted() {
          setTasks((prev) => prev.filter((t) => !t.completed));
        }

        return (
          <div>
            <form onSubmit={addTask} className="flex gap-2 mb-4">
              <input
                value={text}
                onChange={(e) => setText(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addTask(e);
                  }
                }}
                placeholder="Add a task and press Enter"
                className="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400"
              />
              <button
                type="submit"
                className="rounded-md bg-brand-600 text-white px-4 py-2 hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-400"
              >
                Add
              </button>
            </form>

            {tasks.length === 0 ? (
              <EmptyState />
            ) : (
              <div className="space-y-2">
                {tasks.map((task) => (
                  <TaskItem
                    key={task.id}
                    task={task}
                    onToggle={() => toggleTask(task.id)}
                    onDelete={() => deleteTask(task.id)}
                  />
                ))}
              </div>
            )}

            <div className="mt-4 flex items-center justify-between text-sm text-slate-600">
              <span>{remaining} remaining</span>
              <button
                onClick={clearCompleted}
                className="text-slate-500 hover:text-brand-700 hover:underline disabled:opacity-40"
                disabled={tasks.every((t) => !t.completed)}
              >
                Clear completed
              </button>
            </div>
          </div>
        );
      }

      function TaskItem({ task, onToggle, onDelete }) {
        return (
          <div className="group flex items-center gap-3 rounded-md border border-slate-200 px-3 py-2 hover:bg-slate-50">
            <input
              id={task.id}
              type="checkbox"
              checked={task.completed}
              onChange={onToggle}
              className="h-5 w-5 accent-brand-600"
            />
            <label
              htmlFor={task.id}
              className={
                'flex-1 cursor-pointer select-none ' +
                (task.completed ? 'line-through text-slate-400' : 'text-slate-800')
              }
            >
              {task.text}
            </label>
            <button
              onClick={onDelete}
              className="opacity-60 hover:opacity-100 text-red-600 text-sm px-2 py-1"
              title="Delete task"
            >
              Delete
            </button>
          </div>
        );
      }

      function EmptyState() {
        return (
          <div className="rounded-md border border-dashed border-slate-300 p-6 text-center text-slate-500">
            No tasks yet. Add your first task above.
          </div>
        );
      }

      function cryptoRandomId() {
        if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
        const bytes =
          window.crypto && crypto.getRandomValues
            ? crypto.getRandomValues(new Uint8Array(16))
            : Array.from({ length: 16 }, () => Math.floor(Math.random() * 256));
        return [...bytes]
          .map((b, i) => (i === 4 || i === 6 || i === 8 || i === 10 ? '-' : '') + b.toString(16).padStart(2, '0'))
          .join('');
      }

      const root = ReactDOM.createRoot(document.getElementById('app'));
      root.render(<App />);
    </script>
  </body>
</html>
